<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>ChessClan</title>
    </h:head>
    <h:body>
        <ui:composition>
            <script>
                $(document).ready(function() {
                    $("#tabs").tabs().addClass('ui-tabs-vertical ui-helper-clearfix');
                    $("#tabs li").removeClass('ui-corner-top').addClass('ui-corner-left noMargin noPadding');
                    $("#tabs ul").addClass('noMargin noPadding');

                });
            </script>
            <div id="tabs">
                <ul>
                    <li><a href="#tabs-1">Moje turnieje</a></li>
                    <li><a href="#tabs-2">Przeglądaj turnieje</a></li>
                    <li><a href="#tabs-3">Ogłoszenia</a></li>
                    <li><a href="#tabs-4">Kluby</a></li>
                </ul>
                <div id="tabs-1">
                    <c:forEach items="#{atvBean.allTournaments}" var="tmt">
                        <h:panelGroup layout="block" >
                            <h:outputText value="#{tmt.name}"/>
                            <h:outputText value="Nazwa klubu: #{tmt.club.name}"/>
                            <h:outputText value="Kiedy: #{tmt.date}"/>
                            <h:outputText value="Opis: #{tmt.description}"/>
                        </h:panelGroup>
                        <hr/>
                    </c:forEach>
                </div>
                <div id="tabs-2">

                    <c:forEach items="#{atvBean.allTournaments}" var="tmt">
                        <h:panelGroup layout="block" >
                            <h:form prependId="false">
                                <h:panelGroup rendered="#{atvBean.joiningSucc}" layout="block" class="ui-state-highlight ui-corner-all">
                                    <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
                                        <strong>Gratulacje!</strong> Zostałeś zapisany na turniej.</p>
                                </h:panelGroup>
                                <h:outputText value="#{tmt.name}"/>
                                <h:outputText value="Nazwa klubu: #{tmt.club.name}"/>
                                <h:outputText value="Kiedy: #{tmt.date}"/>
                                <h:outputText value="Opis: #{tmt.description}"/>
                                <h:commandButton value="Zapisz się" rendered="#{atvBean.isJoinable(tmt)}">
                                    <f:ajax render="@form" listener="#{atvBean.joinTournament(tmt)}"/>
                                </h:commandButton>
                            </h:form>
                        </h:panelGroup>
                        <hr/>
                    </c:forEach>

                </div>
                <div id="tabs-3">
                    <h:form prependId="false" >
                        <script>
                            $(function() {
                                $("#accordion").accordion({
                                    collapsible: true,
                                    heightStyle: "content",
                                    active: '#myPostsHeader'
                                });
                            });
                        </script>
                        <div id="accordion">
                            <h3 id="addPostHeader">Dodaj ogłoszenie</h3>
                            <div>
                                <h:panelGroup id="messages">
                                    <h:panelGroup rendered="#{upBean.postPublished}" layout="block" class="ui-state-highlight ui-corner-all">
                                        <script>
                                            $("#accordion").accordion({
                                                collapsible: true,
                                                heightStyle: "content",
                                                active: '#myPostsHeader'
                                            });
                                        </script>
                                        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
                                            <strong>Uwaga!</strong> Twoje ogłoszenie zostało opublikowane. Teraz widzą je inni użytkownicy.</p>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{upBean.postSaved}" layout="block" class="ui-state-highlight ui-corner-all">
                                        <script>
                                            $("#accordion").accordion({
                                                collapsible: true,
                                                heightStyle: "content",
                                                active: '#myPostsHeader'
                                            });
                                        </script>
                                        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
                                            <strong>Uwaga!</strong> Twoje ogłoszenie zostało zapisane. Aby widzieli je inni użytkownicy, przejdź do zakładki "Moje ogłoszenia" i je opublikuj.</p>
                                    </h:panelGroup>
                                    <h:panelGroup id="wrongPost" rendered="#{upBean.postWrong}" layout="block" class="ui-state-error ui-corner-all">
                                        <script>
                                            $("#accordion").accordion({
                                                collapsible: true,
                                                heightStyle: "content",
                                                active: '#addPostHeader'
                                            });
                                        </script>
                                        <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>
                                            <strong>Hej!</strong> Dodawanie ogłoszeń to nie zabawa. Proszę wpisać prawidłowe ogłoszenie!</p>
                                    </h:panelGroup>
                                </h:panelGroup>
                                <h:outputText value="Tytuł"/>
                                <h:inputText value="#{upBean.title}">
                                    <f:ajax event="blur" execute="@this" render="messages" listener="#{upBean.validateTitle}"/>
                                </h:inputText>
                                <h:outputText value="Treść"/>
                                <h:inputText value="#{upBean.content}">
                                    <f:ajax event="blur" execute="@this" render="messages" listener="#{upBean.validateContent}"/>
                                </h:inputText>
                                <h:commandButton value="Zapisz i opublikuj">
                                    <f:ajax execute="@form" render="@form" listener="#{upBean.saveAndPublish}"/>
                                </h:commandButton>
                                <h:commandButton value="Zapisz">
                                    <f:ajax execute="@form" render="@form" listener="#{upBean.save}"/>
                                </h:commandButton>

                            </div>
                            <h3 id="myPostsHeader">Moje ogłoszenia</h3>
                            <div>
                                <c:if test="#{upBean.userPosts.size()>0}">
                                    <h:dataTable value="#{upBean.userPosts}" var="post">
                                        <h:column>
                                            <!-- column header -->
                                            <f:facet name="header">Tytuł</f:facet>
                                            <!-- row record -->
                                            #{post.title}
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">Treść</f:facet>
                                            #{post.content}
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">Autor</f:facet>
                                            <h:outputText value="#{loginBean.user.firstName} #{loginBean.user.lastName}"/>
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">Data opublikowania</f:facet>
                                            <h:outputText rendered="#{post.published}" value="#{post.datePublished}">
                                                <f:convertDateTime pattern="dd-MM-yyyy"/>
                                            </h:outputText>
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">Publikowanie</f:facet>        
                                            <h:commandButton value="Opublikuj" rendered="#{not post.published}">
                                                <f:ajax render="@form" listener="#{upBean.publishPost(post)}"/>
                                            </h:commandButton>            
                                            <h:commandButton value="Ukryj" rendered="#{post.published}">
                                                <f:ajax render="@form" listener="#{upBean.unPublishPost(post)}"/>
                                            </h:commandButton>
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">Usuń</f:facet>         
                                            <h:commandButton value="Usuń">
                                                <f:ajax render="@form" listener="#{upBean.removePost(post)}"/>
                                            </h:commandButton>
                                        </h:column>
                                    </h:dataTable>
                                </c:if>
                                <c:if test="#{upBean.userPosts.size() == 0}">
                                    <h:panelGroup layout="block" class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0 .7em;">
                                        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
                                            Nie masz żadnego zapisanego ogłoszenia. Aby je stworzyć, przejdź do zakładki "Dodaj ogłoszenie"
                                        </p>
                                    </h:panelGroup>
                                </c:if>
                            </div>
                            <h3>Wszystkie ogłoszenia</h3>
                            <div>
                                <h:panelGroup layout="block" id="allPostsTable">
                                    <c:forEach items="#{upBean.allPosts}" var="post">
                                        <h:panelGroup layout="block" class="postHeader">
                                            <h:outputText value="#{post.title}" class="postTitle"/>
                                            <h:outputText value="#{post.datePublished}" class="postTitle"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" class="postContent">
                                            <h:outputText value="#{post.content}" class="postTitle"/>
                                        </h:panelGroup>
                                        <hr/>
                                    </c:forEach>
                                </h:panelGroup>
                            </div>
                        </div>
                    </h:form>
                </div>
                <div id="tabs-4">
                    <h:form prependId="false">
                        <script>
                            var actItem = 'myClubHeader';
                            $(function() {
                                $("#accordionClubs").accordion({
                                    collapsible: true,
                                    heightStyle: "content",
                                    active: '#' + actItem
                                });
                            });
                        </script>
                        <div id="accordionClubs">
                            <h3 id="myClubHeader">Mój klub</h3>
                            <div>
                                <h:panelGroup rendered="#{ucBean.userClub == null}" layout="block" class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0 .7em;">
                                    <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
                                        Nie jesteś zapisana/y do żadnego klubu. Aby to zrobić, przejdź do następnej zakładki.
                                    </p>
                                </h:panelGroup>
                                <h:panelGroup layout="block" rendered="#{ucBean.userClub != null}">
                                    <h4>#{ucBean.userClub.name}</h4>
                                    <h:panelGroup>
                                        <h:outputText value="Data utworzenia: #{ucBean.userClub.creationDate}"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <h:outputText value="#{ucBean.userClub.description}"/>
                                    </h:panelGroup>
                                    <h:commandButton value="Wypisz się" onclick="actItem = 'allClubsHeader';">
                                        <f:ajax render="@form" listener="#{ucBean.signOutFromClub}" />
                                    </h:commandButton>
                                </h:panelGroup>

                            </div>

                            <h3 id="allClubsHeader">Wszystkie kluby w systemie</h3>
                            <div>
                                <h:dataTable value="#{ucBean.clubs}" var="club">
                                    <h:column>
                                        <!-- column header -->
                                        <f:facet name="header">Nazwa klubu</f:facet>
                                        <!-- row record -->
                                        #{club.name}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Opis</f:facet>
                                        #{club.description}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Data założenia</f:facet>
                                        <h:outputText value="#{club.creationDate}"/>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header"></f:facet>
                                        <h:commandButton value="Zapisz się" rendered="#{ucBean.userClub == null}" onclick="actItem = 'myClubHeader';">
                                            <f:ajax render="@form" listener="#{ucBean.signToClub(club)}"/>
                                        </h:commandButton>                                            

                                        <h:commandButton value="Wypisz się" rendered="#{ucBean.userClub == club}" onclick="actItem = 'allClubsHeader';">
                                            <f:ajax render="@form" listener="#{ucBean.signOutFromClub}"/>
                                        </h:commandButton>
                                    </h:column>
                                </h:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>
        </ui:composition>
    </h:body>
</html>

